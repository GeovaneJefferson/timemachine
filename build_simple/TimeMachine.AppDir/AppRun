#!/bin/bash
APPDIR="$(dirname "$(readlink -f "${0}")")"
cd "${APPDIR}/opt/TimeMachine"

echo "Starting Time Machine..."

# Verify electron exists
ELECTRON="${APPDIR}/opt/TimeMachine/node_modules/electron/dist/electron"
if [ ! -f "$ELECTRON" ]; then
    echo "ERROR: Electron not found at: $ELECTRON"
    echo "Contents of node_modules/electron/dist/:"
    ls -la "${APPDIR}/opt/TimeMachine/node_modules/electron/dist/" 2>/dev/null || echo "Directory doesn't exist"
    exit 1
fi

chmod +x "$ELECTRON" 2>/dev/null || true

# Start Flask
python3 app.py > /tmp/timemachine.log 2>&1 &
FLASK_PID=$!
sleep 3

# Start Electron
"$ELECTRON" main.js --no-sandbox

kill $FLASK_PID 2>/dev/null
echo "Done"
